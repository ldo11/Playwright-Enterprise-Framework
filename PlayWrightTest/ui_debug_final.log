RESPONSE: http://localhost:4200/dashboard - 200
RESPONSE: http://localhost:4200/runtime.js - 200
RESPONSE: http://localhost:4200/polyfills.js - 200
BROWSER CONSOLE: info: [webpack-dev-server] Server started: Hot Module Replacement disabled, Live Reloading enabled, Progress disabled, Overlay enabled.
RESPONSE: http://localhost:4200/styles.css - 200
RESPONSE: http://localhost:4200/styles.js - 200
RESPONSE: http://localhost:4200/main.js - 200
RESPONSE: http://127.0.0.1:3001/clients?mine=true - 401
BROWSER CONSOLE: error: Failed to load resource: the server responded with a status of 401 (Unauthorized)
BROWSER CONSOLE: error: Il
DEBUG: Snackbar detected: Failed to load clients
Dismiss
RESPONSE: http://127.0.0.1:3001/clients - 401
BROWSER CONSOLE: error: Failed to load resource: the server responded with a status of 401 (Unauthorized)
BROWSER CONSOLE: error: Il
F
=================================== FAILURES ===================================
___________________ TestTestProductUI.test_add_client_via_ui ___________________

self = <test_testproduct_ui.TestTestProductUI object at 0x1115a5df0>
auth_page = <Page url='http://localhost:4200/dashboard'>
api_context = <playwright._impl._fetch.APIRequestContext object at 0x111683dc0>

    def test_add_client_via_ui(self, auth_page, api_context):
        """Create a client via the UI and assert its first name appears as a clickable entry."""
        # Capture browser console logs for debugging
        auth_page.on("console", lambda msg: print(f"BROWSER CONSOLE: {msg.type}: {msg.text}"))
        auth_page.on("requestfailed", lambda req: print(f"REQUEST FAILED: {req.url} - {req.failure}"))
        auth_page.on("response", lambda res: print(f"RESPONSE: {res.url} - {res.status}"))
    
        home = HomePage(auth_page)
        home.goto()
    
        assert home.is_logged_in(), "Precondition: user should be logged in."
    
        # Unique name to ensure we find the right one
        import uuid
        unique_suffix = str(uuid.uuid4())[:8]
        first_name = f"Playwright_{unique_suffix}"
    
        try:
            # Using MM/DD/YYYY for UI input as Angular Material default locale often expects this
>           home.add_client(first_name, "User", "01/01/2000", "Male")

tests/test_testproduct_ui.py:35: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <pages.home_page.HomePage object at 0x1118e3af0>
first_name = 'Playwright_8759e0e8', last_name = 'User', dob = '01/01/2000'
sex = 'Male'

    def add_client(self, first_name: str, last_name: str, dob: str, sex: str = "Male") -> None:
        """Create a new client through the UI form."""
        self.add_client_button.click()
        self.page.get_by_label("First Name").fill(first_name)
        self.page.get_by_label("Last Name").fill(last_name)
    
        # Robust date handling: click, clear, type (simulate user input for mask)
        dob_field = self.page.get_by_label("Date of Birth")
        dob_field.click()
        dob_field.fill("")
        dob_field.type(dob, delay=50) # Type slowly to ensure mask captures it
    
        # Angular Material 'mat-select'
        self.page.locator("mat-select[formControlName='sex']").click()
        self.page.get_by_role("option", name=sex, exact=True).click()
    
        save_btn = self.page.get_by_role("button", name="Save")
    
        # Wait for button to be enabled (implies form is valid)
        try:
            expect(save_btn).to_be_enabled(timeout=2000)
        except AssertionError:
            print("DEBUG: Save button is disabled. Checking validation errors...")
            errors = self.page.locator("mat-error").all_inner_texts()
            print(f"DEBUG: Found validation errors: {errors}")
            # Fail early if form is invalid
            raise
    
        save_btn.click()
    
        # Check for error snackbar
        try:
            snackbar = self.page.locator("simple-snack-bar").first
            if snackbar.is_visible(timeout=3000):
                text = snackbar.inner_text()
                print(f"DEBUG: Snackbar detected: {text}")
        except:
            pass
    
        # Wait for dialog to close to ensure client is added and list is refreshing
>       expect(self.page.get_by_role("dialog")).to_be_hidden()
E       AssertionError: Locator expected to be hidden
E       Actual value: visible 
E       Call log:
E         - Expect "to_be_hidden" with timeout 5000ms
E         - waiting for get_by_role("dialog")
E           9 × locator resolved to <mat-dialog-container tabindex="-1" role="dialog" aria-modal="false" id="mat-mdc-dialog-0" aria-labelledby="mat-mdc-dialog-title-0" class="mat-mdc-dialog-container mdc-dialog cdk-dialog-container mat-mdc-dialog-container-with-actions mdc-dialog--open">…</mat-dialog-container>
E             - unexpected value "visible"

pages/home_page.py:73: AssertionError
=============================== warnings summary ===============================
.venv/lib/python3.9/site-packages/urllib3/__init__.py:35
  /Users/luat/Main/Playwright-Enterprise-Framework/PlayWrightTest/.venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_testproduct_ui.py::TestTestProductUI::test_add_client_via_ui
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 16 deselected, 1 warning in 7.84s
